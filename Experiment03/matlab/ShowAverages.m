%
% ShowAverages.m
% 
% gaze_confidenceの平均値とpupil_diameterの平均値を求める(0値は除外して計算する)
% 全体のうち、confidenceが0のデータがどのくらいあるのかを求める
% 全体のうち、一定のconfidence値を超えるデータがどのくらいあるのかを求める
%
function ShowAverages
  % File Index
  RF_fixline_filenames = [
    "RF/RF_fixline_20201219", ...
    "RF/RF_fixline_20201219_2", ...
    "RF/RF_fixline_20201219_3", ...
    "RF/RF_fixline_20201219_4", ...
    "RF/RF_fixline_20201219_5", ...
    "RF/RF_fixline_20201219_6", ...
    "RF/RF_fixline_20201219_7", ...
    "RF/RF_fixline_20201219_8"];
  RH_fixline_filenames = [
    "RH/RH_fixline_20201223", ...
    "RH/RH_fixline_20201218_2", ...
    "RH/RH_fixline_20201218_3", ...
    "RH/RH_fixline_20201218_4", ...
    "RH/RH_fixline_20201223_2", ...
    "RH/RH_fixline_20201223_3", ...
    "RH/RH_fixline_20201223_4", ...
    "RH/RH_fixline_20201223_5"];
  RA_fixline_filenames = [
    "RA/RA_fixline_20201221", ...
    "RA/RA_fixline_20201221_2", ...
    "RA/RA_fixline_20201221_3", ...
    "RA/RA_fixline_20201221_4", ...
    "RA/RA_fixline_20201222", ...
    "RA/RA_fixline_20201222_2", ...
    "RA/RA_fixline_20201223", ...
    "RA/RA_fixline_20201222_4"];
  AM_fixline_filenames = [
    "AM/AM_fixline_20201222", ...
    "AM/AM_fixline_20201222_2", ...
    "AM/AM_fixline_20201222_3", ...
    "AM/AM_fixline_20201222_4", ...
    "AM/AM_fixline_20201223", ...
    "AM/AM_fixline_20201223_2", ...
    "AM/AM_fixline_20201223_3", ...
    "AM/AM_fixline_20201223_4"];
  HKo_fixline_filenames = [
    "HKo/HKo_fixline_20201225", ...
    "HKo/HKo_fixline_20201225_2", ...
    "HKo/HKo_fixline_20201225_3", ...
    "HKo/HKo_fixline_20201224", ...
    "HKo/HKo_fixline_20201224_2", ...
    "HKo/HKo_fixline_20201224_3", ...
    "HKo/HKo_fixline_20201224_4", ...
    "HKo/HKo_fixline_20201224_5"];
  
  % Settings
  check_confidence = 0.6; % check_confidence以上のデータが何%あるのか調べる
  fileNames = RF_fixline_filenames;
  
  tic

  line_sum = 0;
  pupil_diameter_sum = 0;
  pupil_diameter_count = 0;
  gaze_confidence_sum = 0;
  gaze_confidence_count = 0;
  zero_confidence_count = 0;
  over_check_confidence_count = 0;

  for fileName = fileNames
    filePath = strcat('Results/', fileName, '_eyedata.txt');
    fileID = fopen(filePath);
    N = 11;
    C_header = textscan(fileID, '%s', N);
    C = textscan(fileID, '%f %f %f %f %f %f %f %f %f %f %f');
    % 1st pupil_diameter
    % 10th gaze_confidence
    diameter = C{1,1};
    eyeconf = C{1,10};

    line_sum = line_sum + length(eyeconf);
    
    for i = 1:length(eyeconf)
      % pupil_diameter_sum, pupil_diameter_countの加算処理
      if diameter(i) > 0 % 0以上のものだけ加算する
        pupil_diameter_sum = pupil_diameter_sum + diameter(i);
        pupil_diameter_count = pupil_diameter_count + 1;
      end
      % gaze_confidence_sum, gaze_confidence_countの加算処理
      if eyeconf(i) > 0 % 0以上のものだけ加算する
        gaze_confidence_sum = gaze_confidence_sum + eyeconf(i);
        gaze_confidence_count = gaze_confidence_count + 1;
      end
      % zero_confidence_countの加算処理
      if eyeconf(i) == 0
        zero_confidence_count = zero_confidence_count + 1;
      end
      % over_check_confidence_countの加算処理
      if eyeconf(i) > check_confidence
        over_check_confidence_count = over_check_confidence_count + 1;
      end
    end
  end

  disp("pupil diameter average: " + pupil_diameter_sum/pupil_diameter_count);
  disp("confidence average: " + gaze_confidence_sum/gaze_confidence_count);
  disp("confidence = 0: " + (zero_confidence_count/line_sum)*100 + "%");
  disp("confidence > " + check_confidence + ": " + (over_check_confidence_count/line_sum)*100 + "%");

  toc
end
